---
export const prerender = false;
  import PostCard from "@/components/blog/PostCard.astro";
import { CategoriesSlugSchema, CategorySchema, PostsSchema } from "../../../types";
  
  import Layout from "@/layouts/Layout.astro";

  export async function getStaticPaths() {
    const res=await fetch(`${import.meta.env.API_URL}/categories?_fields=slug`);
    const json = await res.json();
    const categories = CategoriesSlugSchema.parse(json);
    return categories.map((category) => ({
      params: { slug: category.slug },
    }));
  }

  const { slug } = Astro.params;
  const catUrl=`${import.meta.env.API_URL}/categories?slug=${slug}`;
  const catRes = await fetch(catUrl);
  const catJson = await catRes.json();
  
  const category = CategorySchema.parse(catJson[0]);

  const postsUrl = `${import.meta.env.API_URL}/posts?categories=${category.id}`;
  const postsRes = await fetch(postsUrl);
  const postsJson = await postsRes.json();
  const posts = PostsSchema.parse(postsJson);
  console.log(posts);
  

---
<Layout
    title={`Post en la Categoría: ${category.name}`}
    subtitle={`Posts en la categoría: ${category.name}`}
    bgImage={posts[0].featured_image?.full.url}
>
    {posts.map( post => <PostCard post={post} />)}
</Layout>